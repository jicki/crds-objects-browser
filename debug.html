<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRDs Browser è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .data-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .resource-item {
            padding: 8px;
            margin: 5px 0;
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 3px;
        }
        .resource-group {
            font-weight: bold;
            color: #495057;
        }
        .resource-name {
            color: #007bff;
        }
        .resource-version {
            color: #6c757d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” CRDs Objects Browser è°ƒè¯•é¡µé¢</h1>
        
        <div class="section">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <button onclick="checkHealth()">æ£€æŸ¥å¥åº·çŠ¶æ€</button>
            <button onclick="checkAPI()">æ£€æŸ¥APIå“åº”</button>
            <button onclick="checkCache()">æ£€æŸ¥ç¼“å­˜çŠ¶æ€</button>
            <div id="healthStatus"></div>
        </div>

        <div class="section">
            <h3>ğŸ“¦ èµ„æºæ•°æ®æµ‹è¯•</h3>
            <button onclick="fetchResources()">è·å–èµ„æºåˆ—è¡¨</button>
            <button onclick="fetchNamespaces()">è·å–å‘½åç©ºé—´</button>
            <button onclick="testFrontendAPI()">æµ‹è¯•å‰ç«¯API</button>
            <div id="resourcesStatus"></div>
            <div id="resourcesData" class="data-display" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>ğŸŒ å‰ç«¯é¡µé¢æµ‹è¯•</h3>
            <button onclick="openMainPage()">æ‰“å¼€ä¸»é¡µé¢</button>
            <button onclick="openUIPage()">æ‰“å¼€UIé¡µé¢</button>
            <button onclick="testConsole()">æµ‹è¯•æ§åˆ¶å°</button>
            <div id="frontendStatus"></div>
        </div>

        <div class="section">
            <h3>ğŸ”§ æ€§èƒ½ç›‘æ§</h3>
            <button onclick="checkPerformance()">æ£€æŸ¥æ€§èƒ½ç»Ÿè®¡</button>
            <button onclick="monitorCache()">ç›‘æ§ç¼“å­˜</button>
            <div id="performanceStatus"></div>
        </div>
    </div>

    <script>
        // å¥åº·çŠ¶æ€æ£€æŸ¥
        async function checkHealth() {
            const statusDiv = document.getElementById('healthStatus');
            statusDiv.innerHTML = '<div class="status warning">æ­£åœ¨æ£€æŸ¥å¥åº·çŠ¶æ€...</div>';
            
            try {
                const response = await fetch('/healthz');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="status success">
                            âœ… æœåŠ¡å¥åº·çŠ¶æ€æ­£å¸¸<br>
                            æœåŠ¡: ${data.service}<br>
                            çŠ¶æ€: ${data.status}<br>
                            æ—¶é—´: ${data.timestamp}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ å¥åº·æ£€æŸ¥é”™è¯¯: ${error.message}</div>`;
            }
        }

        // APIå“åº”æ£€æŸ¥
        async function checkAPI() {
            const statusDiv = document.getElementById('healthStatus');
            statusDiv.innerHTML += '<div class="status warning">æ­£åœ¨æ£€æŸ¥APIå“åº”...</div>';
            
            try {
                const response = await fetch('/api/crds');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    statusDiv.innerHTML += `
                        <div class="status success">
                            âœ… APIå“åº”æ­£å¸¸<br>
                            èµ„æºæ•°é‡: ${data.length}<br>
                            å“åº”æ—¶é—´: ${response.headers.get('x-response-time') || 'æœªçŸ¥'}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML += `<div class="status error">âŒ APIå“åº”å¼‚å¸¸: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">âŒ APIè¯·æ±‚é”™è¯¯: ${error.message}</div>`;
            }
        }

        // ç¼“å­˜çŠ¶æ€æ£€æŸ¥
        async function checkCache() {
            const statusDiv = document.getElementById('healthStatus');
            statusDiv.innerHTML += '<div class="status warning">æ­£åœ¨æ£€æŸ¥ç¼“å­˜çŠ¶æ€...</div>';
            
            try {
                const response = await fetch('/api/cache/status');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML += `
                        <div class="status success">
                            âœ… ç¼“å­˜çŠ¶æ€æ­£å¸¸<br>
                            æ´»è·ƒInformer: ${data.activeInformers || 0}<br>
                            å°±ç»ªèµ„æº: ${data.readyResources || 0}<br>
                            æ€»å¯¹è±¡æ•°: ${data.totalObjects || 0}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML += `<div class="status error">âŒ ç¼“å­˜çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">âŒ ç¼“å­˜çŠ¶æ€æ£€æŸ¥é”™è¯¯: ${error.message}</div>`;
            }
        }

        // è·å–èµ„æºåˆ—è¡¨
        async function fetchResources() {
            const statusDiv = document.getElementById('resourcesStatus');
            const dataDiv = document.getElementById('resourcesData');
            
            statusDiv.innerHTML = '<div class="status warning">æ­£åœ¨è·å–èµ„æºåˆ—è¡¨...</div>';
            
            try {
                const response = await fetch('/api/crds');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    statusDiv.innerHTML = `
                        <div class="status success">
                            âœ… èµ„æºåˆ—è¡¨è·å–æˆåŠŸ<br>
                            æ€»æ•°é‡: ${data.length}<br>
                            å“åº”å¤§å°: ${JSON.stringify(data).length} å­—èŠ‚
                        </div>
                    `;
                    
                    // æ˜¾ç¤ºèµ„æºæ•°æ®
                    displayResources(data);
                    dataDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ èµ„æºåˆ—è¡¨è·å–å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ èµ„æºåˆ—è¡¨è·å–é”™è¯¯: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºèµ„æºæ•°æ®
        function displayResources(resources) {
            const dataDiv = document.getElementById('resourcesData');
            
            // æŒ‰ç»„åˆ†ç±»
            const groups = {};
            resources.forEach(resource => {
                const group = resource.group || 'core';
                if (!groups[group]) {
                    groups[group] = [];
                }
                groups[group].push(resource);
            });
            
            let html = '<h4>ğŸ“¦ èµ„æºåˆ†ç»„æ˜¾ç¤º:</h4>';
            
            Object.keys(groups).sort().forEach(group => {
                html += `<div class="resource-group">ğŸ“ ${group} (${groups[group].length} ä¸ªèµ„æº)</div>`;
                
                groups[group].slice(0, 5).forEach(resource => {
                    html += `
                        <div class="resource-item">
                            <span class="resource-name">${resource.name}</span>
                            <span class="resource-version">(${resource.version})</span>
                            - ${resource.kind}
                            ${resource.namespaced ? 'ğŸ·ï¸ å‘½åç©ºé—´çº§' : 'ğŸŒ é›†ç¾¤çº§'}
                        </div>
                    `;
                });
                
                if (groups[group].length > 5) {
                    html += `<div class="resource-item">... è¿˜æœ‰ ${groups[group].length - 5} ä¸ªèµ„æº</div>`;
                }
            });
            
            dataDiv.innerHTML = html;
        }

        // è·å–å‘½åç©ºé—´
        async function fetchNamespaces() {
            const statusDiv = document.getElementById('resourcesStatus');
            
            statusDiv.innerHTML += '<div class="status warning">æ­£åœ¨è·å–å‘½åç©ºé—´...</div>';
            
            try {
                const response = await fetch('/api/namespaces');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    statusDiv.innerHTML += `
                        <div class="status success">
                            âœ… å‘½åç©ºé—´è·å–æˆåŠŸ<br>
                            æ•°é‡: ${data.length}<br>
                            ç¤ºä¾‹: ${data.slice(0, 3).join(', ')}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML += `<div class="status error">âŒ å‘½åç©ºé—´è·å–å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">âŒ å‘½åç©ºé—´è·å–é”™è¯¯: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•å‰ç«¯API
        async function testFrontendAPI() {
            const statusDiv = document.getElementById('resourcesStatus');
            
            statusDiv.innerHTML += '<div class="status warning">æ­£åœ¨æµ‹è¯•å‰ç«¯API...</div>';
            
            // æµ‹è¯•å¤šä¸ªAPIç«¯ç‚¹
            const endpoints = [
                '/api/crds',
                '/api/namespaces',
                '/api/cache/stats',
                '/api/performance/stats'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    if (response.ok) {
                        statusDiv.innerHTML += `
                            <div class="status success">
                                âœ… ${endpoint}: æ­£å¸¸ (${Array.isArray(data) ? data.length + ' é¡¹' : 'å¯¹è±¡'})
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML += `
                            <div class="status error">âŒ ${endpoint}: å¤±è´¥ (${response.status})</div>
                        `;
                    }
                } catch (error) {
                    statusDiv.innerHTML += `
                        <div class="status error">âŒ ${endpoint}: é”™è¯¯ (${error.message})</div>
                    `;
                }
            }
        }

        // æ‰“å¼€ä¸»é¡µé¢
        function openMainPage() {
            const statusDiv = document.getElementById('frontendStatus');
            statusDiv.innerHTML = '<div class="status warning">æ­£åœ¨æ‰“å¼€ä¸»é¡µé¢...</div>';
            
            window.open('/', '_blank');
            statusDiv.innerHTML += '<div class="status success">âœ… ä¸»é¡µé¢å·²åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€</div>';
        }

        // æ‰“å¼€UIé¡µé¢
        function openUIPage() {
            const statusDiv = document.getElementById('frontendStatus');
            statusDiv.innerHTML = '<div class="status warning">æ­£åœ¨æ‰“å¼€UIé¡µé¢...</div>';
            
            window.open('/ui/', '_blank');
            statusDiv.innerHTML += '<div class="status success">âœ… UIé¡µé¢å·²åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€</div>';
        }

        // æµ‹è¯•æ§åˆ¶å°
        function testConsole() {
            const statusDiv = document.getElementById('frontendStatus');
            
            console.log('=== CRDs Browser è°ƒè¯•ä¿¡æ¯ ===');
            console.log('å½“å‰æ—¶é—´:', new Date().toISOString());
            console.log('ç”¨æˆ·ä»£ç†:', navigator.userAgent);
            console.log('é¡µé¢URL:', window.location.href);
            
            statusDiv.innerHTML = `
                <div class="status success">
                    âœ… æ§åˆ¶å°æµ‹è¯•å®Œæˆ<br>
                    è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
                </div>
            `;
        }

        // æ£€æŸ¥æ€§èƒ½ç»Ÿè®¡
        async function checkPerformance() {
            const statusDiv = document.getElementById('performanceStatus');
            statusDiv.innerHTML = '<div class="status warning">æ­£åœ¨æ£€æŸ¥æ€§èƒ½ç»Ÿè®¡...</div>';
            
            try {
                const response = await fetch('/api/performance/stats');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="status success">
                            âœ… æ€§èƒ½ç»Ÿè®¡è·å–æˆåŠŸ<br>
                            è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æ§åˆ¶å°
                        </div>
                    `;
                    console.log('æ€§èƒ½ç»Ÿè®¡:', data);
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ æ€§èƒ½ç»Ÿè®¡è·å–å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ€§èƒ½ç»Ÿè®¡è·å–é”™è¯¯: ${error.message}</div>`;
            }
        }

        // ç›‘æ§ç¼“å­˜
        async function monitorCache() {
            const statusDiv = document.getElementById('performanceStatus');
            statusDiv.innerHTML += '<div class="status warning">æ­£åœ¨ç›‘æ§ç¼“å­˜...</div>';
            
            try {
                const response = await fetch('/api/cache/stats');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML += `
                        <div class="status success">
                            âœ… ç¼“å­˜ç›‘æ§æˆåŠŸ<br>
                            è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æ§åˆ¶å°
                        </div>
                    `;
                    console.log('ç¼“å­˜ç»Ÿè®¡:', data);
                } else {
                    statusDiv.innerHTML += `<div class="status error">âŒ ç¼“å­˜ç›‘æ§å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">âŒ ç¼“å­˜ç›‘æ§é”™è¯¯: ${error.message}</div>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡ŒåŸºç¡€æ£€æŸ¥
        window.onload = function() {
            console.log('CRDs Browser è°ƒè¯•é¡µé¢å·²åŠ è½½');
            checkHealth();
        };
    </script>
</body>
</html> 