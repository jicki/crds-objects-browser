# Docker æ ‡ç­¾æ ¼å¼ä¼˜åŒ–

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†å¦‚ä½•ä¿®æ”¹Dockeræ„å»ºæ ‡ç­¾æ ¼å¼ï¼Œä½¿å…¶æ›´åŠ ç®€æ´å’Œæ˜“è¯»ã€‚

## ğŸ”§ ä¿®æ”¹å†…å®¹

### ä¿®æ”¹å‰
```bash
VERSION := $(shell git describe --tags --always --dirty)
# ç”Ÿæˆçš„æ ‡ç­¾: v0.2.7-1-ge48d77b-dirty
```

### ä¿®æ”¹å
```bash
VERSION := $(shell git describe --tags --always | sed 's/-g[a-f0-9]*.*$$//' | sed 's/-dirty$$//')
# ç”Ÿæˆçš„æ ‡ç­¾: v0.2.7-1
```

## ğŸ¯ æ•ˆæœå¯¹æ¯”

| ä¿®æ”¹å‰ | ä¿®æ”¹å |
|--------|--------|
| `v0.2.7-1-ge48d77b-dirty` | `v0.2.7-1` |
| `v0.2.7-1-ge48d77b` | `v0.2.7-1` |
| `v0.2.7` | `v0.2.7` |

## ğŸ“ æ ‡ç­¾æ ¼å¼è¯´æ˜

æ–°çš„æ ‡ç­¾æ ¼å¼åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- **ä¸»ç‰ˆæœ¬å·**: `v0.2.7` - æœ€è¿‘çš„Gitæ ‡ç­¾
- **æäº¤æ¬¡æ•°**: `-1` - è‡ªæœ€è¿‘æ ‡ç­¾ä»¥æ¥çš„æäº¤æ¬¡æ•°ï¼ˆå¦‚æœæœ‰ï¼‰

å»é™¤çš„ä¿¡æ¯ï¼š
- **Gitå“ˆå¸Œ**: `-ge48d77b` - Gitæäº¤çš„çŸ­å“ˆå¸Œ
- **Dirtyæ ‡è®°**: `-dirty` - å·¥ä½œç›®å½•æœ‰æœªæäº¤çš„æ›´æ”¹

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
```bash
make info
```

### 2. æ„å»ºDockeré•œåƒ
```bash
make docker-build
```

### 3. æŸ¥çœ‹æ„å»ºçš„é•œåƒ
```bash
docker images | grep crds-browser
```

### 4. è‡ªå®šä¹‰æ ‡ç­¾
å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
DOCKER_TAG=custom-tag make docker-build
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### sedå‘½ä»¤è§£é‡Š
```bash
git describe --tags --always | sed 's/-g[a-f0-9]*.*$$//' | sed 's/-dirty$$//'
```

1. `git describe --tags --always`: è·å–Gitæè¿°ä¿¡æ¯
2. `sed 's/-g[a-f0-9]*.*$$//'`: ç§»é™¤Gitå“ˆå¸ŒåŠå…¶åçš„æ‰€æœ‰å†…å®¹
3. `sed 's/-dirty$$//'`: ç§»é™¤æœ«å°¾çš„"-dirty"æ ‡è®°

### æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜
- `-g[a-f0-9]*.*$$`: åŒ¹é…"-g"å¼€å¤´ï¼Œåè·Ÿåå…­è¿›åˆ¶å­—ç¬¦ï¼Œç›´åˆ°è¡Œå°¾
- `-dirty$$`: åŒ¹é…è¡Œå°¾çš„"-dirty"

## ğŸ“Š ä¼˜åŠ¿

1. **ç®€æ´æ€§**: æ ‡ç­¾æ›´çŸ­ï¼Œæ›´æ˜“è¯»
2. **ä¸€è‡´æ€§**: æ— è®ºå·¥ä½œç›®å½•æ˜¯å¦å¹²å‡€ï¼Œæ ‡ç­¾æ ¼å¼ä¸€è‡´
3. **å¯è¯»æ€§**: ä¸“æ³¨äºç‰ˆæœ¬ä¿¡æ¯ï¼Œå»é™¤æŠ€æœ¯ç»†èŠ‚
4. **å…¼å®¹æ€§**: ä¿æŒè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒä¿¡æ¯

## ğŸ”„ å›æ»šæ–¹æ³•

å¦‚æœéœ€è¦æ¢å¤åˆ°åŸæ¥çš„æ ¼å¼ï¼Œä¿®æ”¹Makefileä¸­çš„VERSIONå®šä¹‰ï¼š
```bash
VERSION := $(shell git describe --tags --always --dirty)
```

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# æŸ¥çœ‹æ„å»ºä¿¡æ¯
make info

# æ„å»ºDockeré•œåƒ
make docker-build

# æ¨é€Dockeré•œåƒ
make docker-push

# è¿è¡ŒDockerå®¹å™¨
make docker-run

# åœæ­¢Dockerå®¹å™¨
make docker-stop

# æ¸…ç†Dockeré•œåƒ
make clean
```

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªç®€å•çš„ä¿®æ”¹ï¼ŒDockeræ ‡ç­¾ä»å†—é•¿çš„`v0.2.7-1-ge48d77b-dirty`å˜æˆäº†ç®€æ´çš„`v0.2.7-1`ï¼Œæé«˜äº†å¯è¯»æ€§å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶ä¿ç•™äº†ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒä¿¡æ¯ã€‚ 